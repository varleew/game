<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HarnelDice Casino</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white; 
            font-family: 'Arial', sans-serif;
            min-height: 100vh;
        }
        .container { 
            max-width: 500px; 
            margin: 0 auto; 
            padding: 20px;
        }
        .header { 
            text-align: center; 
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(26, 26, 46, 0.9);
            border-radius: 20px;
            border: 2px solid #e94560;
        }
        .logo { 
            font-size: 32px; 
            font-weight: bold; 
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        .balance-card { 
            background: rgba(15, 52, 96, 0.8);
            padding: 25px;
            border-radius: 20px;
            margin-bottom: 25px;
            text-align: center;
            border: 2px solid rgba(78, 204, 163, 0.5);
        }
        .balance-amount { 
            font-size: 48px; 
            color: #4ecca3; 
            font-weight: bold;
            margin: 10px 0;
        }
        .btn { 
            display: block;
            width: 100%;
            padding: 18px;
            margin: 15px 0;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            color: white;
        }
        .btn-primary { 
            background: linear-gradient(135deg, #e94560, #ff6b6b);
        }
        .btn-success { 
            background: linear-gradient(135deg, #4ecca3, #26a69a);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .btn:active { transform: translateY(-1px); }
        
        .games-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 25px 0;
        }
        .game-card {
            background: linear-gradient(145deg, rgba(108, 92, 231, 0.3), rgba(165, 94, 234, 0.2));
            border-radius: 15px;
            padding: 25px 15px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .game-card:hover {
            border-color: #e94560;
            transform: scale(1.05);
        }
        .game-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }
        .game-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .game-multiplier {
            color: #ffd166;
            font-weight: bold;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            width: 100%;
            max-width: 500px;
            border-radius: 20px;
            padding: 30px;
            border: 2px solid #e94560;
            position: relative;
        }
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 30px;
            color: #e94560;
            cursor: pointer;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            background: rgba(233, 69, 96, 0.9);
            color: white;
            padding: 15px;
            border-radius: 12px;
            font-weight: bold;
            text-align: center;
            z-index: 9999;
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            color: #ffd166;
            font-size: 18px;
        }
        
        @media (max-width: 500px) {
            .container { padding: 10px; }
            .balance-amount { font-size: 36px; }
            .games-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ -->
        <div class="header">
            <div class="logo">üé≤ HarnelDice Casino</div>
            <div>–ò–≥—Ä–∞–π—Ç–µ –∏ –≤—ã–∏–≥—Ä—ã–≤–∞–π—Ç–µ USDT!</div>
        </div>
        
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –±–∞–ª–∞–Ω—Å–∞ -->
        <div class="balance-card">
            <div style="font-size: 14px; color: rgba(255,255,255,0.8);">–í–ê–® –ë–ê–õ–ê–ù–°</div>
            <div class="balance-amount" id="balanceAmount">0.00 USDT</div>
            <div style="margin-top: 15px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <button class="btn btn-success" onclick="openDepositModal()">üí≥ –ü–û–ü–û–õ–ù–ò–¢–¨</button>
                    <button class="btn btn-secondary" onclick="openWithdrawModal()">üí∏ –í–´–í–ï–°–¢–ò</button>
                </div>
            </div>
        </div>
        
        <!-- –ò–≥—Ä—ã -->
        <h2 style="text-align: center; margin-bottom: 20px; color: #4ecca3;">üé∞ –í–´–ë–ï–†–ò–¢–ï –ò–ì–†–£</h2>
        
        <div class="games-grid" id="gamesGrid">
            <div class="game-card" onclick="playGame('dice')">
                <div class="game-icon">üé≤</div>
                <div class="game-name">–ö–£–ë–ò–ö</div>
                <div class="game-multiplier">–í–´–ò–ì–†–´–® 1.8x</div>
            </div>
            
            <div class="game-card" onclick="playGame('basketball')">
                <div class="game-icon">üèÄ</div>
                <div class="game-name">–ë–ê–°–ö–ï–¢–ë–û–õ</div>
                <div class="game-multiplier">–í–´–ò–ì–†–´–® 1.8x</div>
            </div>
            
            <div class="game-card" onclick="playGame('football')">
                <div class="game-icon">‚öΩ</div>
                <div class="game-name">–§–£–¢–ë–û–õ</div>
                <div class="game-multiplier">–í–´–ò–ì–†–´–® 1.8x</div>
            </div>
            
            <div class="game-card" onclick="playGame('darts')">
                <div class="game-icon">üéØ</div>
                <div class="game-name">–î–ê–†–¢–°</div>
                <div class="game-multiplier">–î–û 2.5x</div>
            </div>
        </div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div style="margin-top: 30px;">
            <button class="btn btn-primary" onclick="updateBalance()">
                üîÑ –û–ë–ù–û–í–ò–¢–¨ –ë–ê–õ–ê–ù–°
            </button>
            <button class="btn btn-secondary" onclick="showGameHistory()">
                üìã –ò–°–¢–û–†–ò–Ø –ò–ì–†
            </button>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
        <div style="margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 15px;">
            <h3 style="color: #ffd166; margin-bottom: 10px;">‚ÑπÔ∏è –ò–ù–§–û–†–ú–ê–¶–ò–Ø</h3>
            <p>‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞: <strong>0.28 USDT</strong></p>
            <p>‚Ä¢ –í—Å–µ –ø–ª–∞—Ç–µ–∂–∏ —á–µ—Ä–µ–∑ Telegram Wallet</p>
            <p>‚Ä¢ –ò–≥—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç Provably Fair</p>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–µ–ø–æ–∑–∏—Ç–∞ -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('depositModal')">&times;</span>
            <h2 style="color: #4ecca3; margin-bottom: 20px;">üí≥ –ü–û–ü–û–õ–ù–ï–ù–ò–ï –ë–ê–õ–ê–ù–°–ê</h2>
            
            <div style="margin-bottom: 25px;">
                <p>–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è (–º–∏–Ω–∏–º—É–º 0.3 USDT):</p>
                <input type="number" id="depositAmount" placeholder="0.3" 
                       style="width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #4ecca3; background: rgba(255,255,255,0.1); color: white; font-size: 18px; margin: 15px 0;">
            </div>
            
            <button class="btn btn-success" onclick="processDeposit()">
                üí≥ –°–û–ó–î–ê–¢–¨ –î–ï–ü–û–ó–ò–¢
            </button>
            
            <div style="margin-top: 25px; padding: 15px; background: rgba(78, 204, 163, 0.1); border-radius: 10px;">
                <p style="font-size: 14px; color: #ffd166;">
                    üí° –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞ –æ—Ç–∫—Ä–æ–µ—Ç—Å—è Telegram Wallet –¥–ª—è –æ–ø–ª–∞—Ç—ã.
                </p>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–≤–æ–¥–∞ -->
    <div class="modal" id="withdrawModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('withdrawModal')">&times;</span>
            <h2 style="color: #ffd166; margin-bottom: 20px;">üí∏ –í–´–í–û–î –°–†–ï–î–°–¢–í</h2>
            
            <div style="margin-bottom: 25px;">
                <p>–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –≤—ã–≤–æ–¥–∞:</p>
                <input type="number" id="withdrawAmount" placeholder="0.3" 
                       style="width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #ffd166; background: rgba(255,255,255,0.1); color: white; font-size: 18px; margin: 10px 0;">
                
                <p style="margin-top: 15px;">–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Telegram ID –∏–ª–∏ @username:</p>
                <input type="text" id="walletAddress" placeholder="@username –∏–ª–∏ ID" 
                       style="width: 100%; padding: 15px; border-radius: 10px; border: 2px solid #ffd166; background: rgba(255,255,255,0.1); color: white; font-size: 18px; margin: 10px 0;">
            </div>
            
            <button class="btn btn-secondary" onclick="processWithdraw()">
                üí∏ –û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–Ø–í–ö–£
            </button>
            
            <div style="margin-top: 25px; padding: 15px; background: rgba(255, 209, 102, 0.1); border-radius: 10px;">
                <p style="font-size: 14px; color: #e94560;">
                    ‚ö†Ô∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥: 0.3 USDT<br>
                    üìâ –ö–æ–º–∏—Å—Å–∏—è: 0.1 USDT<br>
                    ‚è±Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞: 1-24 —á–∞—Å–∞
                </p>
            </div>
        </div>
    </div>
    
    <!-- –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä -->
    <div class="modal" id="historyModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('historyModal')">&times;</span>
            <h2 style="color: #e94560; margin-bottom: 20px;">üìã –ò–°–¢–û–†–ò–Ø –ò–ì–†</h2>
            <div id="historyContent" class="loading">
                –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏...
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.expand();
        tg.MainButton.hide();
        tg.BackButton.hide();
        
        // –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        let userBalance = 0;
        let userId = tg.initDataUnsafe.user?.id || 0;
        
        // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateBalance();
            setupTelegramEvents();
        });
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ Telegram
        function setupTelegramEvents() {
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –±–æ—Ç–∞
            tg.onEvent('viewportChanged', function() {
                // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
            });
            
            // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –≤ Telegram
            tg.BackButton.onClick(function() {
                closeAllModals();
            });
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç–∞ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏
            tg.onEvent('beforeunload', function() {
                // –ú–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            });
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        async function updateBalance() {
            showLoading();
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –±–∞–ª–∞–Ω—Å–∞ –≤ –±–æ—Ç–∞
                const data = {
                    action: 'get_balance',
                    user_id: userId,
                    timestamp: new Date().toISOString()
                };
                
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º Telegram Web App Data –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
                if (tg.sendData) {
                    tg.sendData(JSON.stringify(data));
                }
                
                // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –º–æ–∂–µ–º "—Å–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å" –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
                // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –±–æ—Ç –æ—Ç–≤–µ—Ç–∏—Ç —á–µ—Ä–µ–∑ handle_web_app_data
                
                // –î–ª—è –¥–µ–º–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–π –±–∞–ª–∞–Ω—Å –∏–∑ localStorage
                const savedBalance = localStorage.getItem('harneldice_balance');
                if (savedBalance) {
                    userBalance = parseFloat(savedBalance);
                    document.getElementById('balanceAmount').textContent = userBalance.toFixed(2) + ' USDT';
                }
                
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞');
            }
            
            hideLoading();
        }
        
        // –ò–≥—Ä–∞
        async function playGame(gameType) {
            const betAmount = 0.28; // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞
            
            if (userBalance < betAmount) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –¥–ª—è –∏–≥—Ä—ã');
                openDepositModal();
                return;
            }
            
            showLoading();
            
            try {
                const data = {
                    action: 'make_bet',
                    game_type: gameType,
                    amount: betAmount,
                    user_id: userId,
                    client_seed: 'user_seed_' + Date.now(),
                    timestamp: new Date().toISOString()
                };
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –±–æ—Ç–∞
                if (tg.sendData) {
                    tg.sendData(JSON.stringify(data));
                }
                
                // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç –±–æ—Ç–∞
                // –î–ª—è –¥–µ–º–æ - —Å–∏–º—É–ª—è—Ü–∏—è –∏–≥—Ä—ã
                simulateGame(gameType, betAmount);
                
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ –∏–≥—Ä—ã');
                hideLoading();
            }
        }
        
        // –°–∏–º—É–ª—è—Ü–∏—è –∏–≥—Ä—ã (–¥–ª—è –¥–µ–º–æ)
        function simulateGame(gameType, betAmount) {
            setTimeout(() => {
                const win = Math.random() < 0.45; // 45% —à–∞–Ω—Å
                const multiplier = 1.8;
                
                if (win) {
                    const winAmount = betAmount * multiplier;
                    userBalance = userBalance - betAmount + winAmount;
                    showNotification(`üéâ –í–´ –í–´–ò–ì–†–ê–õ–ò ${winAmount.toFixed(2)} USDT!`);
                } else {
                    userBalance -= betAmount;
                    showNotification('üòî –í–´ –ü–†–û–ò–ì–†–ê–õ–ò');
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å
                localStorage.setItem('harneldice_balance', userBalance);
                document.getElementById('balanceAmount').textContent = userBalance.toFixed(2) + ' USDT';
                
                hideLoading();
            }, 1500);
        }
        
        // –î–µ–ø–æ–∑–∏—Ç
        function openDepositModal() {
            document.getElementById('depositModal').style.display = 'flex';
            tg.BackButton.show();
        }
        
        async function processDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            
            if (!amount || amount < 0.3) {
                showNotification('–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –¥–µ–ø–æ–∑–∏—Ç: 0.3 USDT');
                return;
            }
            
            showLoading();
            
            try {
                const data = {
                    action: 'deposit_request',
                    amount: amount,
                    user_id: userId,
                    timestamp: new Date().toISOString()
                };
                
                if (tg.sendData) {
                    tg.sendData(JSON.stringify(data));
                }
                
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º Wallet —Å—Å—ã–ª–∫—É
                const walletLink = 'http://t.me/send?start=IVrChEJeXaIU';
                
                // –í Web App –æ—Ç–∫—Ä—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É
                if (tg.openLink) {
                    tg.openLink(walletLink);
                } else {
                    window.open(walletLink, '_blank');
                }
                
                showNotification(`–î–µ–ø–æ–∑–∏—Ç –Ω–∞ ${amount} USDT —Å–æ–∑–¥–∞–Ω. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram Wallet.`);
                closeModal('depositModal');
                
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ–ø–æ–∑–∏—Ç–∞');
            }
            
            hideLoading();
        }
        
        // –í—ã–≤–æ–¥
        function openWithdrawModal() {
            if (userBalance < 0.3) {
                showNotification('–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥: 0.3 USDT');
                return;
            }
            
            document.getElementById('withdrawModal').style.display = 'flex';
            tg.BackButton.show();
        }
        
        async function processWithdraw() {
            const amount = parseFloat(document.getElementById('withdrawAmount').value);
            const walletAddress = document.getElementById('walletAddress').value.trim();
            
            if (!amount || amount < 0.3) {
                showNotification('–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤—ã–≤–æ–¥: 0.3 USDT');
                return;
            }
            
            if (amount > userBalance) {
                showNotification('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤');
                return;
            }
            
            if (!walletAddress) {
                showNotification('–í–≤–µ–¥–∏—Ç–µ Telegram ID –∏–ª–∏ @username');
                return;
            }
            
            showLoading();
            
            try {
                const data = {
                    action: 'withdraw_request',
                    amount: amount,
                    wallet_address: walletAddress,
                    user_id: userId,
                    timestamp: new Date().toISOString()
                };
                
                if (tg.sendData) {
                    tg.sendData(JSON.stringify(data));
                }
                
                showNotification(`–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ ${amount} USDT –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞`);
                closeModal('withdrawModal');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å
                userBalance -= amount;
                localStorage.setItem('harneldice_balance', userBalance);
                document.getElementById('balanceAmount').textContent = userBalance.toFixed(2) + ' USDT';
                
            } catch (error) {
                showNotification('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞—è–≤–∫–∏ –Ω–∞ –≤—ã–≤–æ–¥');
            }
            
            hideLoading();
        }
        
        // –ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä
        async function showGameHistory() {
            document.getElementById('historyModal').style.display = 'flex';
            tg.BackButton.show();
            
            try {
                const data = {
                    action: 'get_game_history',
                    user_id: userId,
                    limit: 10,
                    timestamp: new Date().toISOString()
                };
                
                if (tg.sendData) {
                    tg.sendData(JSON.stringify(data));
                }
                
                // –î–ª—è –¥–µ–º–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥–ª—É—à–∫—É
                document.getElementById('historyContent').innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <p>–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
                        <p style="font-size: 14px; color: rgba(255,255,255,0.7); margin-top: 10px;">
                            –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤–∞—à–∞ –∏—Å—Ç–æ—Ä–∏—è
                        </p>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('historyContent').innerHTML = `
                    <div style="color: #e94560; text-align: center;">
                        –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏
                    </div>
                `;
            }
        }
        
        // –£—Ç–∏–ª–∏—Ç—ã
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        function showLoading() {
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            document.body.style.opacity = '0.8';
            document.body.style.pointerEvents = 'none';
        }
        
        function hideLoading() {
            document.body.style.opacity = '1';
            document.body.style.pointerEvents = 'auto';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            tg.BackButton.hide();
        }
        
        function closeAllModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
            tg.BackButton.hide();
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –±–æ—Ç–∞ (–µ—Å–ª–∏ –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —á–µ—Ä–µ–∑ Web App)
        // Telegram Web App –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ—Ç –±–æ—Ç–∞ —á–µ—Ä–µ–∑ window.Telegram.WebApp.receiveData
        // –∏–ª–∏ —á–µ—Ä–µ–∑ window.Telegram.WebApp.onEvent('message', handler)
        
        if (tg.onEvent) {
            tg.onEvent('message', function(data) {
                try {
                    const message = JSON.parse(data);
                    handleBotMessage(message);
                } catch (e) {
                    console.error('Error parsing bot message:', e);
                }
            });
        }
        
        function handleBotMessage(message) {
            const action = message.action;
            
            if (action === 'balance_update') {
                userBalance = message.balance || 0;
                localStorage.setItem('harneldice_balance', userBalance);
                document.getElementById('balanceAmount').textContent = userBalance.toFixed(2) + ' USDT';
                showNotification('–ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª–µ–Ω');
            }
            else if (action === 'bet_result') {
                if (message.success) {
                    userBalance = message.balance || 0;
                    localStorage.setItem('harneldice_balance', userBalance);
                    document.getElementById('balanceAmount').textContent = userBalance.toFixed(2) + ' USDT';
                    
                    if (message.result === 'win') {
                        showNotification(`üéâ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${message.win_amount} USDT!`);
                    } else {
                        showNotification('üòî –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏');
                    }
                } else {
                    showNotification(message.error || '–û—à–∏–±–∫–∞ –∏–≥—Ä—ã');
                }
            }
            else if (action === 'deposit_response') {
                if (message.success) {
                    showNotification(`–î–µ–ø–æ–∑–∏—Ç —Å–æ–∑–¥–∞–Ω. –°—É–º–º–∞: ${message.amount} USDT`);
                } else {
                    showNotification(message.error || '–û—à–∏–±–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–∞');
                }
            }
            else if (action === 'withdraw_response') {
                if (message.success) {
                    showNotification(`–ó–∞—è–≤–∫–∞ –Ω–∞ –≤—ã–≤–æ–¥ —Å–æ–∑–¥–∞–Ω–∞. –°—É–º–º–∞: ${message.amount} USDT`);
                } else {
                    showNotification(message.error || '–û—à–∏–±–∫–∞ –≤—ã–≤–æ–¥–∞');
                }
            }
            else if (action === 'game_history') {
                let historyHTML = '<div style="max-height: 400px; overflow-y: auto;">';
                
                if (message.games && message.games.length > 0) {
                    message.games.forEach(game => {
                        const emoji = game.result === 'win' ? '‚úÖ' : '‚ùå';
                        const color = game.result === 'win' ? '#4ecca3' : '#e94560';
                        
                        historyHTML += `
                            <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 4px solid ${color};">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>${emoji} ${game.game_type}</span>
                                    <span style="color: ${color}; font-weight: bold;">
                                        ${game.result === 'win' ? '+' : '-'}${game.bet_amount} USDT
                                    </span>
                                </div>
                                <div style="font-size: 12px; color: rgba(255,255,255,0.7); margin-top: 5px;">
                                    ${new Date(game.created_at).toLocaleString()}
                                </div>
                            </div>
                        `;
                    });
                } else {
                    historyHTML += '<p style="text-align: center; padding: 20px;">–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä –ø—É—Å—Ç–∞</p>';
                }
                
                historyHTML += '</div>';
                document.getElementById('historyContent').innerHTML = historyHTML;
            }
        }
    </script>
</body>
</html>
